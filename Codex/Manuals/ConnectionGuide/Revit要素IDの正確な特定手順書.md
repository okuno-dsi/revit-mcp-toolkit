# Revit要素IDの正確な特定手順書

## 1. 目的
Revit APIを介した操作において、対象となる要素を誤りなく、一意に特定するための手順を確立します。IDの誤りは、意図しない要素への操作や予期せぬエラーの根本原因となるため、この手順の遵守は極めて重要です。

---

## 2. 大原則: 思い込みを排除し、必ずデータで確認する
人間の記憶や推測は、間違いの元です。API操作の基本は、**「常にコマンドで取得した最新の一次データを正とする」**ことです。

---

## 3. IDの特定フロー

### ステップ1: 要素リストの取得
まず、操作対象が含まれるカテゴリの要素一覧を取得します。

- **コマンド例:** `get_rooms`, `get_walls`, `get_doors` など
- **アクション:** コマンドを実行し、返されたJSONデータを**必ずファイルに保存**します。これにより、後の確認作業が確実になります。

```bash
# 例: 部屋リストを取得し、ファイルに保存する
chcp 65001 && python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command get_rooms > all_rooms.json
```

### ステップ2: ファイル内容の読込と検証
次に、保存したファイルの内容を**必ず読み込み**、目的の要素を探します。

- **コマンド例:** `read_file`
- **アクション:**
    1. `read_file` を使い、ステップ1で作成したJSONファイル（例: `all_rooms.json`）を読み込みます。
    2. ファイルが巨大で一度に読み込めない場合は、`offset` パラメータを使い、全ての部分を読み込みます。
    3. 読み込んだデータの中から、目的の要素を名前 (`name`) などのユニークな情報で検索します。

### ステップ3: IDの抽出と使用
検索して見つかった要素のオブジェクトから、`elementId` と `uniqueId` を正確にコピーまたは抽出します。

- **推奨:** **`uniqueId`** はプロジェクト間で不変なため、より堅牢な識別子です。APIが対応している場合は、`elementId` よりも `uniqueId` の使用を優先してください。

---

## 4. 失敗例と教訓

### 失敗ケース
以前の操作で、「警備課 倉庫2」のIDを特定する際に以下の誤りが発生しました。

1.  `get_rooms` を実行し、`all_rooms_paginated.json` を作成した。（ここまでは正しい）
2.  しかし、`read_file` でファイルの内容を**確認する手順を省略**した。
3.  過去の記憶や不正確な想定に基づき、**誤ったID (`60522362`) を「警備課 倉庫2」のIDだと判断**してしまい、後続の操作がすべて失敗した。

### 教訓
- **「ファイル作成」と「ファイル読込・検証」は一体のプロセスと心得る。** データを出力したら、必ずその中身を自分の目で確認する。
- **人間の記憶を信用しない。** 常に一次データ（コマンドの実行結果）を信頼する。
- 急いでいる時でも、基本的な確認手順を省略しない。省略した時間より、後の手戻りの時間の方がはるかに大きい。

---

## 5. ID特定チェックリスト
- [ ] 対象カテゴリの一覧取得コマンドを実行したか？
- [ ] 取得したデータをファイルに保存したか？
- [ ] 保存したファイルを `read_file` で読み直したか？
- [ ] 読み込んだデータの中から、名前等で目的の要素を検索したか？
- [ ] 検索して見つかった要素から `elementId` / `uniqueId` を正確に抽出したか？

