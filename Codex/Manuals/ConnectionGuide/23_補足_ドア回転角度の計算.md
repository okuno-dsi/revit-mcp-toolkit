# ドアの回転角度の計算方法

## 1. 目的
Revitアドインの `get_door_orientation` コマンドで取得した `facingOrientation` ベクトル情報から、ドアの平面上の正確な回転角度（0～360度など）を計算する方法を説明します。

## 2. 背景
`get_door_orientation` コマンドは、ドアの向きを直接的な角度ではなく、`facingOrientation` (開き方向) という単位ベクトル（XとYの要素を持つ）で返します。

このベクトルから実際の角度を計算するには、数学的な計算、特に `atan2` 関数を利用する必要があります。

## 3. 必要なコマンド
-   `get_door_orientation`: ドアの向きに関するベクトル情報を取得します。

**実行例:**
```bash
python Python/Scripts/Reference/send_revit_command_durable.py --port 5210 --command get_door_orientation --params "{"elementId": 60525880}"
```

**実行結果例:**
```json
{
  "ok": true,
  "facingOrientation": {"x": -3.259E-15, "y": -1.0, "z": 0.0},
  ...
}
```
この結果の `facingOrientation` の `x` と `y` の値を使用します。

## 4. Pythonでの角度計算手順

取得した `x` と `y` の値を使用して、Pythonの `math` モジュールで角度を計算できます。

```python
import math

# get_door_orientation から取得したベクトル
facing_orientation = {"x": -3.259E-15, "y": -1.0, "z": 0.0}

# atan2関数でラジアンを取得
# math.atan2(y, x) の順序であることに注意
angle_rad = math.atan2(facing_orientation['y'], facing_orientation['x'])

# ラジアンを度に変換
angle_deg = math.degrees(angle_rad)

# 角度を 0-360度の範囲に正規化 (任意)
if angle_deg < 0:
    angle_deg += 360

print(f"ドアの向き (X軸からの角度): {angle_deg:.2f} 度")
# 出力例: ドアの向き (X軸からの角度): 270.00 度
```

## 5. 解説
`math.atan2(y, x)` は、座標平面上の点(x, y)と原点を結ぶ線が、X軸の正の方向となす角度をラジアン単位で返します。これにより、4象限すべてにおいて正しい角度を求めることができます。
`math.degrees()` は、そのラジアン値を一般的な度数法の角度に変換します。

```



