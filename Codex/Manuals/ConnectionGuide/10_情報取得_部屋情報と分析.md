# 部屋情報の取得と分析

## 概要
このドキュメントでは、Revitモデル内の部屋に関する情報を取得し、その属性（境界壁、高さなど）を分析する手順を説明します。

## 前提条件
* 「環境設定と接続確認」の手順が完了していること。
* Revitモデルに部屋が配置されていること。

## コマンド詳細

### GetRoomsCommand
* **目的:** Revitモデル内のすべての部屋の基本情報を取得します。
* **Revitアドイン `method`:** `get_rooms`
* **パラメータ (`params`) 例:**
```json
{}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "totalCount": 2,
  "rooms": [
    {
      "elementId": 60522362,
      "name": "前室",
      "area": 25.0,
      "level": "1FL",
      "center": {"x": 8563.774, "y": 9546.32, "z": 0.0}
    },
    {
      "elementId": 60528905,
      "name": "特別室",
      "area": 25.0,
      "level": "1FL",
      "center": {"x": 14307.929, "y": 9321.721, "z": 0.0}
    }
  ]
}
```

### GetRoomBoundaryWallsCommand
* **目的:** 指定した部屋を囲む壁の要素IDを取得します。
* **Revitアドイン `method`:** `get_room_boundary_walls`
* **パラメータ (`params`) 例:**
```json
{
  "elementId": 60522362
}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "wallIds": [123, 456, 789]
}
```

### GetRoomParamsCommand
* **目的:** 指定した部屋のすべてのパラメータを取得します。これには天井高さなどの情報が含まれる場合があります。
* **Revitアドイン `method`:** `get_room_params`
* **パラメータ (`params`) 例:**
```json
{
  "roomId": 60522362
}
```
* **結果 (`result`) 例:** (一部抜粋)
```json
{
  "ok": true,
  "totalCount": 76,
  "parameters": [
    {
      "name": "部屋高さ(レベル指定)",
      "id": -1006920,
      "storageType": "Double",
      "value": 4000.0
    },
    {
      "name": "仕上表 CH",
      "id": 50483356,
      "storageType": "String",
      "value": "2700"
    }
  ]
}
```

### GetLevelsCommand
* **目的:** Revitモデル内のすべてのレベルの情報を取得します。部屋や天井の絶対高さを計算する際に使用します。
* **Revitアドイン `method`:** `get_levels`
* **パラメータ (`params`) 例:**
```json
{}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "totalCount": 4,
  "levels": [
    {
      "levelId": 49173,
      "name": "1FL",
      "elevation": 0.0
    }
  ]
}
```

### GetRoomBoundaryCommand
* **目的:** 指定した部屋の境界ループの座標を取得します。部屋の平面的な範囲を把握するために使用します。
* **Revitアドイン `method`:** `get_room_boundary`
* **パラメータ (`params`) 例:**
```json
{
  "elementId": 60522362
}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "totalCount": 1,
  "loops": [
    {
      "loopIndex": 0,
      "segments": [
        {"start": {"x": 6618.075, "y": 7338.622, "z": 0.0}, "end": {"x": 11428.075, "y": 7338.622, "z": 0.0}},
        // ... その他のセグメント
      ]
    }
  ]
}
```

### 実行手順
各コマンドは、`Manuals/Scripts/send_revit_command_durable.py` スクリプトを使用して実行します。`--params` には、各コマンドで要求されるパラメータをJSON形式で指定します。

**例: ID `60522362` の部屋の境界壁を取得する**
```bash
python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command get_room_boundary_walls --params "{\"elementId\": 60522362}"
```

**Unique IDを使用する場合（推奨）:**
```bash
python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command get_room_boundary_walls --params "{\"uniqueId\": \"some-room-unique-id\"}"
```

## 分析のポイント
* 部屋の面積とスペースの面積には差異が生じることがあります。これはRevitにおける「部屋」と「スペース」の定義の違いによるものです。
* 天井高さについては、「部屋高さ(レベル指定)」と「仕上表 CH」のどちらが意図する高さであるか、プロジェクトの慣例に従って判断してください。実際の天井要素の高さと比較することで、より正確な情報を得られます。

