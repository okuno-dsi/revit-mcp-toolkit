# 壁の向きに応じた色分け手順書

## 1. 目的
Revitのビュー内で、基準として選択した壁と同じ向きを持つ壁と、それ以外の壁を異なる色で表示上書きします。

## 2. 関連コマンド
-   `get_current_view`: 現在アクティブなビューのIDを取得します。
-   `get_selected_element_ids`: ユーザーが選択した要素のIDを取得します。
-   `get_walls`: プロジェクト内の全ての壁の情報を取得します（始点・終点座標を含む）。
-   `set_visual_override`: 特定の要素の表示色と透過度を変更します。

## 3. ワークフロー

1.  **基準の壁を選択**: Revitのビュー上で、基準としたい壁を1つ選択します。

2.  **情報収集**:
    -   `get_current_view` を実行し、ビューIDを取得します。
    -   `get_selected_element_ids` を実行し、選択した壁のIDを取得します。
    -   `get_walls` を実行し、プロジェクト内の全壁のリスト（IDと始点・終点座標を含む）を取得します。

3.  **向きの計算と分類 (クライアント側)**:
    -   Pythonスクリプト側で、取得した全壁のリストから、選択した基準壁の情報を探し出します。
    -   基準壁の始点・終点座標から、その向きを示すベクトルを計算します。
    -   全壁リストをループ処理し、各壁の向きベクトルを計算します。
    -   各壁のベクトルと基準壁のベクトルを比較し、平行（または反平行）であるかを判定します。
    -   判定結果に基づき、全壁を「同じ向きの壁」と「異なる向きの壁」の2つのリストに分類します。

4.  **色分けの実行**:
    -   分類した2つの壁リストをそれぞれループ処理します。
    -   リスト内の各壁IDに対して、`set_visual_override` コマンドを個別に実行します。
    -   **注意:** `set_visual_override` コマンドは一度に1つの要素しか処理できません。そのため、スクリプト内でループ処理が必要です。

## 4. 実行例

**例: 特定の壁（ID: 123）を青色に着色する**
```bash
python Python/Scripts/Reference/send_revit_command_durable.py --port 5210 --command set_visual_override --params "{\"viewId\": 401, \"elementId\": 123, \"r\": 0, \"g\": 0, \"b\": 255, \"transparency\": 50}"
```

## 5. 注意事項
-   壁の向きの計算（ベクトルの比較）は、クライアント側のPythonスクリプトで行う必要があります。
-   多数の壁を色分けする場合、`set_visual_override` を何度も呼び出すため、処理に時間がかかることがあります。



