# スペースの配置と管理

## 概要
このドキュメントでは、Revitモデル内にスペースを配置し、その情報を管理（取得、削除、更新）する手順を説明します。

**【重要: IDの取り扱いについて】**
Revit要素の識別には、`Element ID`（整数値）と`Unique ID`（GUID文字列）の2種類があります。`Unique ID`はプロジェクト間で一意であり、より堅牢な識別子として推奨されます。Revit MCPアドインは、`Unique ID`が提供された場合、自動的に対応する`Element ID`に変換して処理する機能を備えています。可能な限り`Unique ID`の使用を優先してください。

## 前提条件
* 「環境設定と接続確認」の手順が完了していること。
* Revitモデルに部屋が配置されていること。

## コマンド詳細

### CreateSpaceCommand
* **目的:** 指定したレベルとX, Y座標に新しいスペースを配置します。
* **Revitアドイン `method`:** `create_space`
* **パラメータ (`params`) 例:**
```json
{
  "levelId": 49173, 
  "x": 8563.774, 
  "y": 9546.32
}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "elementId": 60529906,
  "msg": ""
}
```

### GetSpacesCommand
* **目的:** Revitモデル内のすべてのスペースの情報を取得します。
* **Revitアドイン `method`:** `get_spaces`
* **パラメータ (`params`) 例:**
```json
{}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "totalCount": 2,
  "spaces": [
    {
      "id": 60529906,
      "number": "2",
      "name": "前室",
      "level": "1FL",
      "area": 22.703,
      "center": {"x": 8563.774, "y": 9546.32, "z": 0.0},
      "parameters": []
    }
  ]
}
```

### DeleteSpaceCommand
* **目的:** 指定したIDのスペースを削除します。
* **Revitアドイン `method`:** `delete_space`
* **パラメータ (`params`) 例:**
```json
{
  "elementId": 60526603
}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true
}
```

### UpdateSpaceCommand
* **目的:** 指定したスペースのパラメータ（名前、番号など）を更新します。
* **Revitアドイン `method`:** `update_space`
* **パラメータ (`params`) 例:**
```json
{
  "elementId": 60529906,
  "paramName": "名前",
  "value": "前室"
}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true
}
```

### GetSpaceParamsCommand
* **目的:** 指定したスペースのすべてのパラメータを取得します。
* **Revitアドイン `method`:** `get_space_params`
* **パラメータ (`params`) 例:**
```json
{
  "elementId": 60529907,
  "uniqueId": "some-space-unique-id"
}
```
* **結果 (`result`) 例:** (一部抜粋)
```json
{
  "ok": true,
  "totalCount": 78,
  "parameters": [
    {
      "name": "部屋番号",
      "id": -1114328,
      "storageType": "String",
      "value": "30"
    },
    {
      "name": "部屋名称",
      "id": -1114327,
      "storageType": "String",
      "value": "特別室"
    }
  ]
}
```

### 実行手順
各コマンドは、`Manuals/Scripts/send_revit_command_durable.py` スクリプトを使用して実行します。`--params` には、各コマンドで要求されるパラメータをJSON形式で指定します。

例: 「前室」にスペースを配置する
*   **Element IDを使用する場合:**
    ```bash
    python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command create_space --params "{\"levelId\": 49173, \"x\": 8563.774, \"y\": 9546.32}"
    ```
*   **Unique IDを使用する場合（推奨）:**
    ```bash
    python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command create_space --params "{\"levelUniqueId\": \"some-level-unique-id\", \"x\": 8563.774, \"y\": 9546.32}"
    ```

例: 指定したスペース（ID: 60526603）を削除する
```bash
python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command delete_space --params "{\"elementId\": 60526603}"
```

## 分析のポイント
* `create_space` で配置したスペースは、Revitの1階平面図で確認できます。
* `get_spaces` で取得したスペース情報には、部屋番号や部屋名称が自動的に転写されている場合があります。
* 部屋の面積とスペースの面積には差異が生じることがあります。これはRevitにおける「部屋」と「スペース」の定義の違いによるものです。

