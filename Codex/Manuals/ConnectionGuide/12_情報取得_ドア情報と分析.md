# ドア情報の取得と分析

## 概要
このドキュメントでは、Revitモデル内のドアに関する情報を取得し、その開口方向を分析する手順を説明します。

**【重要: IDの取り扱いについて】**
Revit要素の識別には、`Element ID`（整数値）と`Unique ID`（GUID文字列）の2種類があります。`Unique ID`はプロジェクト間で一意であり、より堅牢な識別子として推奨されます。Revit MCPアドインは、`Unique ID`が提供された場合、自動的に対応する`Element ID`に変換して処理する機能を備えています。可能な限り`Unique ID`の使用を優先してください。

## 前提条件
* 「環境設定と接続確認」の手順が完了していること。
* Revitモデルにドアが配置されていること。

## コマンド詳細

### GetDoorsCommand
* **目的:** Revitモデル内のすべてのドア要素の基本情報を取得します。
* **Revitアドイン `method`:** `get_doors`
* **パラメータ (`params`) 例:**
```json
{}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "totalCount": 2,
  "doors": [
    {
      "elementId": 60525880,
      "typeId": 60171437,
      "typeName": "SD 900x2100",
      "levelId": 49173,
      "hostWallId": 60521946,
      "location": {"x": 7878.0746, "y": 7198.622, "z": 0.0}
    }
  ]
}
```

### GetDoorOrientationCommand
* **目的:** 指定したドア要素の開口方向に関する詳細情報を取得します。
* **Revitアドイン `method`:** `get_door_orientation`
* **パラメータ (`params`) 例:**
```json
{
  "elementId": 60525880,
  "uniqueId": "some-door-unique-id"
}
```
* **結果 (`result`) 例:**
```json
{
  "ok": true,
  "handOrientation": {"x": -1.0, "y": 3.259E-15, "z": 0.0},
  "facingOrientation": {"x": -3.259E-15, "y": -1.0, "z": 0.0},
  "handFlipped": true,
  "facingFlipped": true,
  "openingAngle": 90.0
}
```

### 実行手順
各コマンドは、`Manuals/Scripts/send_revit_command_durable.py` スクリプトを使用して実行します。`--params` には、各コマンドで要求されるパラメータをJSON形式で指定します。

**例: ID `60525880` のドアの開口方向情報を取得する**
*   **Element IDを使用する場合:**
    ```bash
    python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command get_door_orientation --params "{\"elementId\": 60525880}"
    ```
*   **Unique IDを使用する場合（推奨）:**
    ```bash
    python Python/Manuals/Scripts/send_revit_command_durable.py --port 5210 --command get_door_orientation --params "{\"uniqueId\": \"some-door-unique-id\"}"
    ```


## 分析のポイント
* `facingOrientation` はドアが開く方向を示すベクトルです。このベクトルと、ドアがホストされている壁の法線ベクトルを比較することで、ドアが「部屋の内向き」または「部屋の外向き」のどちらに開くかを判断できます。
* `handOrientation` はドアのヒンジ側から見た手の向きを示します。
* `handFlipped` と `facingFlipped` は、それぞれ手の向きと開く方向が反転しているかどうかを示します。

