{
  "commands": [
    {
      "command": "export_view_3dm",
      "category": "Export",
      "summary": "Export visible elements of a Revit 3D view as meshes into a .3dm (Rhino) file.",
      "description": "Captures all visible solids, faces, and instances in the specified 3D view and writes them to a Rhino .3dm file using mesh geometry. Each element's mesh is grouped by category/type and includes Revit metadata (ElementId, UniqueId, Category, TypeName) as UserStrings for downstream Rhino processing.",
      "parameters": {
        "viewId": {
          "type": "integer",
          "description": "ElementId of the 3D view to export."
        },
        "outPath": {
          "type": "string",
          "description": "Full output path of the .3dm file (e.g., 'C:/Exports/RevitModel.3dm')."
        },
        "elementIds": {
          "type": "array",
          "items": "integer",
          "optional": true,
          "description": "Optional subset of element IDs to export. If omitted, exports all visible elements."
        },
        "detailLevel": {
          "type": "string",
          "enum": [
            "Coarse",
            "Medium",
            "Fine"
          ],
          "default": "Fine",
          "optional": true,
          "description": "Geometry detail level to use when exporting meshes."
        },
        "includeLinked": {
          "type": "boolean",
          "default": true,
          "optional": true,
          "description": "Whether to include geometry from linked Revit models."
        },
        "unitsOut": {
          "type": "string",
          "enum": [
            "mm",
            "feet"
          ],
          "default": "mm",
          "optional": true,
          "description": "Output units for all geometry coordinates."
        },
        "weld": {
          "type": "boolean",
          "default": true,
          "optional": true,
          "description": "If true, weld coincident vertices between adjacent triangles."
        },
        "weldTolerance": {
          "type": "number",
          "default": 1E-06,
          "optional": true,
          "description": "Vertex welding tolerance (in feet)."
        },
        "layerMode": {
          "type": "string",
          "enum": [
            "byCategory",
            "byType",
            "byElement",
            "single"
          ],
          "default": "byCategory",
          "optional": true,
          "description": "Controls Rhino layer naming: by Revit Category, Type, Element, or single layer."
        }
      },
      "returns": {
        "ok": {
          "type": "boolean",
          "description": "True if export succeeded."
        },
        "path": {
          "type": "string",
          "description": "Absolute path of the exported .3dm file."
        },
        "units": {
          "type": "string",
          "description": "Units used in the output file ('mm' or 'feet')."
        },
        "viewId": {
          "type": "integer",
          "description": "ID of the exported view."
        },
        "counts": {
          "type": "object",
          "properties": {
            "elements": "integer",
            "meshes": "integer",
            "vertices": "integer",
            "faces": "integer"
          }
        }
      },
      "examples": [
        {
          "request": {
            "jsonrpc": "2.0",
            "id": 1,
            "method": "export_view_3dm",
            "params": {
              "viewId": 123456,
              "outPath": "C:/Exports/RevitModel_3dmMesh.3dm",
              "unitsOut": "mm",
              "includeLinked": true,
              "layerMode": "byCategory"
            }
          },
          "response": {
            "ok": true,
            "path": "C:/Exports/RevitModel_3dmMesh.3dm",
            "units": "mm",
            "viewId": 123456,
            "counts": {
              "elements": 158,
              "meshes": 412,
              "vertices": 125000,
              "faces": 240000
            }
          }
        }
      ],
      "capabilities": [
        "geometry",
        "mesh",
        "export",
        "metadata",
        "external-process",
        "Rhino3dm"
      ]
    },
    {
      "command": "export_view_3dm_brep",
      "category": "Export",
      "summary": "Export visible elements of a Revit 3D view as Breps (planar surfaces) and meshes into a .3dm file.",
      "description": "Exports geometry from the active 3D view into Rhino .3dm format, attempting to preserve analytic surfaces. Planar faces are converted into Brep surfaces using Brep.CreateFromMesh(mesh,true). Non-planar faces fall back to triangulated meshes. Curves (edges, profiles, symbolic lines) are exported where available. Each object contains Revit metadata in UserStrings (ElementId, UniqueId, Category, TypeName). This command is ideal for detailed modeling and analysis workflows in Rhino.",
      "parameters": {
        "viewId": {
          "type": "integer",
          "description": "ElementId of the 3D view to export."
        },
        "outPath": {
          "type": "string",
          "description": "Full output path of the .3dm file (e.g., 'C:/Exports/RevitModel_Brep.3dm')."
        },
        "elementIds": {
          "type": "array",
          "items": "integer",
          "optional": true,
          "description": "Optional subset of element IDs to export."
        },
        "includeLinked": {
          "type": "boolean",
          "default": true,
          "optional": true,
          "description": "Whether to include geometry from linked Revit models."
        },
        "unitsOut": {
          "type": "string",
          "enum": [
            "mm",
            "feet"
          ],
          "default": "mm",
          "optional": true,
          "description": "Output units for all geometry coordinates."
        },
        "layerMode": {
          "type": "string",
          "enum": [
            "byCategory",
            "byType",
            "byElement",
            "single"
          ],
          "default": "byCategory",
          "optional": true,
          "description": "Controls Rhino layer naming."
        },
        "curveTol": {
          "type": "number",
          "default": 0.0001,
          "optional": true,
          "description": "Curve tessellation tolerance (in feet)."
        },
        "angTolDeg": {
          "type": "number",
          "default": 1.0,
          "optional": true,
          "description": "Angular tolerance in degrees for curve approximation."
        }
      },
      "returns": {
        "ok": {
          "type": "boolean",
          "description": "True if export succeeded."
        },
        "path": {
          "type": "string",
          "description": "Absolute path of the exported .3dm file."
        },
        "units": {
          "type": "string",
          "description": "Units used in the output file ('mm' or 'feet')."
        },
        "viewId": {
          "type": "integer",
          "description": "ID of the exported view."
        },
        "counts": {
          "type": "object",
          "properties": {
            "elements": "integer",
            "breps": "integer",
            "meshes": "integer",
            "curves": "integer",
            "vertices": "integer",
            "faces": "integer"
          }
        }
      },
      "examples": [
        {
          "request": {
            "jsonrpc": "2.0",
            "id": 2,
            "method": "export_view_3dm_brep",
            "params": {
              "viewId": 123456,
              "outPath": "C:/Exports/RevitModel_3dmBrep.3dm",
              "unitsOut": "mm",
              "includeLinked": true,
              "layerMode": "byCategory",
              "curveTol": 0.0001,
              "angTolDeg": 1.0
            }
          },
          "response": {
            "ok": true,
            "path": "C:/Exports/RevitModel_3dmBrep.3dm",
            "units": "mm",
            "viewId": 123456,
            "counts": {
              "elements": 152,
              "breps": 980,
              "meshes": 124,
              "curves": 37,
              "vertices": 215430,
              "faces": 402100
            }
          }
        }
      ],
      "capabilities": [
        "geometry",
        "brep",
        "mesh",
        "curve",
        "export",
        "metadata",
        "external-process",
        "Rhino3dm"
      ]
    }
  ],
  "integrationNotes": [
    "Integration Notes",
    "Both commands use CustomExporter + IExportContext, but export_view_3dm_brep rebuilds geometry via Face.Triangulate() to get clean planar Breps.",
    "Output .3dm files are compatible with Rhino, rhino3dm.js, Rhino.Compute, and Grasshopper.",
    "Revit metadata (ElementId, UniqueId, Category, TypeName) are stored in Rhino UserStrings, allowing AI agents or scripts to map Rhino objects back to Revit elements.",
    "export_view_3dm is optimized for speed / lightweight visualization, while export_view_3dm_brep is suited for accurate surface reconstruction and modeling."
  ]
}