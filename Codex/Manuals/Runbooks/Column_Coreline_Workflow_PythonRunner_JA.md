# 柱芯線図ワークフロー（Python Runner）

## 目的
以下の実務フローを、再現しやすい手順として固定化する。

- 通り芯だけのビューを作成
- 柱別ビューの通り芯長さを調整
- 通り芯記号（バブル）を非表示化
- 柱ビュー（1/100）と通り芯ビュー（1/200）をシートで重ね配置

この文書は **運用手順のみ** を対象とし、DLL差し替え・配布作業は含めない。

## 事前準備（モデル側）
- 元ビュー（例: `1/2`）は柱と通り芯が表示されている状態にする。
- 必要に応じて次のビューテンプレートを用意する。
  - `通り心だけ`
  - `構造柱ビュー`
- シート上のビュータイトルタグ非表示は、運用標準に従い手動で実施する（または既存テンプレートで制御）。

## 使用スクリプト
- `Scripts/PythonRunnerScripts/column_grid_coreline_workflow_sample.py`

## スクリプトが実行する処理
1. 元ビューを複写して通り芯ビュー（`*_GRID_BASE`）を作成  
2. 元ビュー内の構造柱を取得（本数は固定値ではなく自動）  
3. 柱ごとにビューを複写（`*_COL_<elementId>`）  
4. 柱外周 +100mm でトリミング  
5. 通り芯を柱中心まわりで `±halfLengthMm` に短縮  
6. 通り芯バブルを非表示  
7. （有効時）シート1枚に通り芯ビュー + 柱別ビューを重ね配置  
   - 位置合わせは `alignByGridIntersection`（グリッド交点アンカー）

## 主な設定値（スクリプト先頭）
- `SOURCE_VIEW_NAME` : 元ビュー名（空ならアクティブビュー）
- `GRID_TEMPLATE_NAME` : 通り芯ビュー用テンプレート名
- `COLUMN_TEMPLATE_NAME` : 柱ビュー用テンプレート名
- `COLUMN_MARGIN_MM` : 柱トリミング余白（既定 `100.0`）
- `GRID_HALF_LENGTH_MM` : 柱中心からの通り芯表示半長（既定 `1000.0`）
- `COLUMN_SCALE` : 柱ビュー縮尺（既定 `100`）
- `GRID_SCALE` : 通り芯ビュー縮尺（既定 `200`）
- `CREATE_SHEET` : シート配置するか
- `MAX_ALLOWED_COLUMNS` : 大量生成防止上限

## 実行手順（Python Runner）
1. Revitで対象プロジェクトを開く。  
2. Python Runnerで `column_grid_coreline_workflow_sample.py` を開く。  
3. 先頭設定値を必要に応じて編集。  
4. `Run` 実行。  
5. 出力JSONで次を確認。
   - `columnCount`
   - 各 `items[].ok`
   - `sheet.ok`（シート作成時）

## 期待結果
- 柱本数に応じた `*_COL_*` ビューが作成される。
- 各柱ビューで、通り芯は柱中心周りの短い表示に調整される。
- 通り芯記号（バブル）が非表示になる。
- シート作成時、通り芯ビュー + 柱ビューが重ね配置される。

## トラブルシュート
- `VIEW_TEMPLATE_APPLIED`  
  - テンプレートでロックされている。スクリプト側は `detachViewTemplate=true` を使うが、制約が強いテンプレートでは手動解除が必要。
- 柱数が想定より多い/少ない  
  - 元ビューの表示状態（カテゴリ/フェーズ/フィルタ）を確認。
- シート位置がずれる  
  - グリッド名の整合（同名グリッド）と、元ビューの通り芯形状を確認。

