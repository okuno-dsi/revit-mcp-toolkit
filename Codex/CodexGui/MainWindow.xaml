<Window x:Class="CodexGui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Codex GUI" Height="600" Width="1170"
        Background="Transparent"
        Foreground="#FFF5F5F5"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResize">
    <Grid Margin="8" x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Backdrop tint layer (only this gets transparent via slider) -->
        <Border x:Name="BackdropBorder"
                Grid.RowSpan="3"
                Background="Transparent"
                CornerRadius="6">
            <Border.Effect>
                <BlurEffect Radius="0" />
            </Border.Effect>
        </Border>

        <!-- Session controls -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,8">
            <TextBlock Text="セッション:" VerticalAlignment="Center" Margin="0,0,4,0"/>
            <ComboBox x:Name="SessionComboBox" Width="200" Margin="0,0,8,0"
                      DisplayMemberPath="Name"
                      SelectionChanged="SessionComboBox_OnSelectionChanged"/>
            <Button x:Name="NewSessionButton" Content="新しいセッション" Width="110" Margin="0,0,8,0"
                    Click="NewSessionButton_OnClick"/>
            <Button x:Name="RenameSessionButton" Content="名前変更" Width="90" Margin="0,0,8,0"
                    Click="RenameSessionButton_OnClick"/>
            <Button x:Name="DeleteSessionButton" Content="削除" Width="70"
                    Click="DeleteSessionButton_OnClick"/>

            <TextBlock Text="  モデル:" VerticalAlignment="Center" Margin="12,0,4,0"/>
            <TextBox x:Name="ModelTextBox" Width="160" Margin="0,0,8,0"
                     ToolTip="Codex モデル名（例: gpt-4.1, gpt-4.1-mini など。実際の有効値は Codex 側に合わせてください）"/>
            <Button x:Name="StatusButton" Content="Status" Width="70"
                    Click="StatusButton_OnClick"
                    ToolTip="Codex 側のステータス取得用プロンプトを送信します"/>

            <TextBlock Text="  フォント:" VerticalAlignment="Center" Margin="12,0,4,0"/>
            <ComboBox x:Name="FontFamilyComboBox" Width="120" Margin="0,0,4,0" VerticalAlignment="Center">
                <ComboBoxItem Content="Meiryo"/>
                <ComboBoxItem Content="Segoe UI"/>
                <ComboBoxItem Content="Consolas"/>
            </ComboBox>
            <TextBox x:Name="FontSizeTextBox" Width="40" Margin="0,0,4,0" VerticalAlignment="Center"/>
            <Button x:Name="ApplyFontButton" Content="適用" Width="60" VerticalAlignment="Center"
                    Click="ApplyFontButton_OnClick"/>
        </StackPanel>

        <!-- Custom caption buttons overlay (top-right) -->
        <Button x:Name="CloseButton"
                Grid.Row="0"
                Content="X"
                Width="28" Height="24"
                HorizontalAlignment="Right" VerticalAlignment="Top"
                Margin="0,0,0,0"
                Click="CloseButton_OnClick"/>

        <!-- History + Conversation -->
        <Grid Grid.Row="1" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Prompt history -->
            <GroupBox x:Name="PromptHistoryGroupBox" Grid.Column="0" Header="過去のプロンプト" Margin="0,0,8,0" Background="Transparent">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,4,0,0">
                        <Button x:Name="UsePromptButton" Content="使用" Width="60" Margin="0,0,4,0"
                                Click="UsePromptButton_OnClick"/>
                        <Button x:Name="EditPromptButton" Content="編集" Width="60" Margin="0,0,4,0"
                                Click="EditPromptButton_OnClick"/>
                        <Button x:Name="DeletePromptButton" Content="削除" Width="60"
                                Click="DeletePromptButton_OnClick"/>
                    </StackPanel>
                    <ListBox x:Name="PromptHistoryListBox"
                             DockPanel.Dock="Top"
                             Margin="0,0,0,4"
                             SelectionMode="Extended"
                             Background="Transparent"
                             MouseDoubleClick="PromptHistoryListBox_OnMouseDoubleClick">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}"
                                           TextWrapping="NoWrap"
                                           TextTrimming="CharacterEllipsis"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </GroupBox>

            <!-- Conversation log + overlay for fall animation -->
            <Grid Grid.Column="1">
                <TextBox x:Name="ConversationTextBox"
                         IsReadOnly="True"
                         TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled"
                         AcceptsReturn="True"
                         Background="#FF1E1E1E"
                         Foreground="#FFF5F5F5"
                         BorderBrush="#FF444444"/>
                <Canvas x:Name="ConversationOverlayCanvas"
                        Background="Transparent"
                        ClipToBounds="True"
                        IsHitTestVisible="False"/>
            </Grid>
        </Grid>

        <!-- Prompt input + send -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBox x:Name="PromptTextBox"
                     Grid.Row="0"
                     Margin="0,0,0,4"
                     Height="80"
                     AcceptsReturn="True"
                     VerticalScrollBarVisibility="Auto"
                     TextWrapping="Wrap"
                     Background="#FF252525"
                     Foreground="#FFF5F5F5"
                     BorderBrush="#FF555555"/>

            <Grid Grid.Row="1"
                  HorizontalAlignment="Stretch"
                  Margin="0,0,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Enter button: 左端から HAL までをフルに使う -->
                <Button x:Name="SendButton"
                        Grid.Column="0"
                        Content="Enter"
                        FontWeight="Bold"
                        Height="30"
                        Margin="0,0,8,0"
                        HorizontalAlignment="Stretch"
                        Click="SendButton_OnClick"/>

                <!-- HAL eye -->
                <Border x:Name="HalEyeBorder"
                        Grid.Column="1"
                        Width="50"
                        Height="50"
                        Margin="0,0,8,0"
                        Background="Transparent"
                        BorderBrush="#555555"
                        BorderThickness="1"
                        MouseLeftButtonDown="HalEyeBorder_OnMouseLeftButtonDown"
                        Visibility="Visible">
                    <Grid>
                        <!-- Outer dark disc -->
                        <Ellipse Fill="#222222"/>
                        <!-- Silver ring -->
                        <Ellipse Margin="8"
                                 Stroke="#B0B0B0"
                                 StrokeThickness="4"/>
                        <!-- Inner red lens (animated only while Codex is busy) -->
                        <Ellipse x:Name="HalRedEllipse"
                                 Margin="18"
                                 Visibility="Collapsed"
                                 RenderTransformOrigin="0.5,0.5">
                            <Ellipse.RenderTransform>
                                <ScaleTransform ScaleX="1.0" ScaleY="1.0"/>
                            </Ellipse.RenderTransform>
                            <Ellipse.Fill>
                                <RadialGradientBrush>
                                    <GradientStop Color="#FFFF4444" Offset="0.0"/>
                                    <GradientStop Color="#FFAA0000" Offset="0.4"/>
                                    <GradientStop Color="#66000000" Offset="1.0"/>
                                </RadialGradientBrush>
                            </Ellipse.Fill>
                        </Ellipse>
                    </Grid>
                </Border>

                <!-- Busy time indicator -->
                <TextBlock x:Name="BusyIndicatorTextBlock"
                           Grid.Column="2"
                           Margin="0,0,8,0"
                           FontSize="14"
                           Foreground="Black"
                           Background="Transparent"
                           VerticalAlignment="Center"
                           FontFamily="Consolas"/>
            </Grid>

            <!-- Opacity and Colors -->
            <StackPanel Grid.Row="2"
                        Orientation="Vertical"
                        HorizontalAlignment="Stretch"
                        Margin="0,4,0,0">
                <!-- Session ID display (above opacity slider) -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Left"
                            Margin="0,0,0,2">
                    <TextBlock Text="Session ID:" VerticalAlignment="Center" Margin="0,0,4,0" FontSize="10"/>
                    <TextBlock x:Name="SessionIdTextBlock"
                               VerticalAlignment="Center"
                               FontSize="10"
                               Foreground="Gray"/>
                </StackPanel>

                <!-- Opacity and Colors -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Stretch"
                            Margin="0,2,0,0">
                    <TextBlock Text="Opacity" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <Slider x:Name="OpacitySlider"
                            Width="150"
                            Minimum="0.1"
                            Maximum="1.0"
                            Value="0.9"
                            TickFrequency="0.05"
                            IsSnapToTickEnabled="True"
                            ValueChanged="OpacitySlider_OnValueChanged"/>
                    <TextBlock Text="{Binding ElementName=OpacitySlider, Path=Value, StringFormat='{}{0:F2}'}"
                               VerticalAlignment="Center" Margin="4,0,16,0" FontSize="10"/>

                    <TextBlock Text="BG" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="BgColorTextBox" Width="90" Text="#122445" Margin="0,0,8,0"/>
                    <TextBlock Text="FG" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox x:Name="FgColorTextBox" Width="90" Text="#C0C0C0" Margin="0,0,8,0"/>
                    <Button x:Name="ApplyColorsButton" Content="Apply" Width="70" Click="ApplyColorsButton_OnClick"/>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Window>



